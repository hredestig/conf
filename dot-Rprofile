# -*- R -*-
library(utils)
library(grDevices)
#Sys.setenv("http_proxy"="http://proxy-bcs.bayerbbs.net:8080")

## avoid java intercepting siginterrupt
options(java.parameters= "-Xrs")
options(width=90)
.dp <- function(verbose=TRUE) {
  tryCatch({
    old <- Sys.getenv("DISPLAY")
    new <- scan("~/.display", what="character", quiet=TRUE)
    Sys.setenv("DISPLAY"=new)
    if(verbose)
      cat(sprintf('display was %s, is now %s', old, new), file=stderr())
  }, error=function(e) {})
}
.dp(FALSE)
.bc <- function(x) {
  source('http://www.bioconductor.org/biocLite.R')
  biocLite(x)
}

.developing <- function(d, p=TRUE) {
  if(!missing(d))
    cat(d, file='~/.developing')
  else {
    d <- scan("~/.developing", what="character", quiet=TRUE)
    if(p)
      d <- as.package(file.path('~', 'workspace', 'personal', 'R', d, 'pkg'))
    
  }
  d
}

options(repos="http://www.freestatistics.org/cran")
options(pdfviewer="/usr/bin/xpdf")
options(digits=5)
X11.options(type="nbcairo")

if(interactive()) {
  suppressMessages(require(devtools))
  dev <- dev_mode
}
  
.reinst <- function(d) {
  if(missing(d)) d <- .developing(p=FALSE)
  pkg <-  as.package(file.path('~', 'workspace', 'personal', 'R', d, 'pkg'))
  system(paste('rm -rf ', .libPaths()[1], '/00LOCK-', d, sep=''))
  document(pkg)
  install(pkg)
  system(paste('rm -rf ', .libPaths()[1], '/00LOCK-', d, sep=''))
}

.install_reports <- function(d) {
  if(missing(d)) d <- .developing(p=FALSE)
  dest <- file.path(.libPaths()[1], d, 'reports')
  src <- file.path(source('~/.Rpackages')[['value']][[d]], 'inst', 'reports')
  vapply(list.files(src, pattern='.R[md]*$'),
         function(r) file.copy(file.path(src, r), dest, overwrite=TRUE),logical(1))
}
       
.install_configs <- function(d) {
  if(missing(d)) d <- .developing(p=FALSE)
  dest <- file.path(.libPaths()[1], d, 'configs')
  src <- file.path(source('~/.Rpackages')[['value']][[d]], 'inst', 'configs')
  vapply(list.files(src, pattern='.rda*$'),
         function(r) file.copy(file.path(src, r), dest, overwrite=TRUE),logical(1))
}

.doc <- function() document(.developing())
